<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OASIS COREANO — Catálogo</title>
    <link rel="shortcut icon" type="imagex/png" href="../images/TESTELOGO.png" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:ital,wght@0,100;0,200;0,300;1,100;1,200;1,300&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <!-- Main site stylesheet (kept external) -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../pages/Catalog.css">

    <!-- UI/UX upgrade CSS (self-contained) -->
    <style>
      :root{
        --bg: #fafafa;
        --card: #ffffff;
        --muted: #7a7a7a;
        --accent: #0f1724; /* deep neutral */
        --accent-2: #1f6feb; /* subtle blue accent (used sparingly) */
        --glass: rgba(255,255,255,0.7);
        --shadow-sm: 0 6px 18px rgba(15,23,36,0.06);
        --shadow-lg: 0 18px 44px rgba(15,23,36,0.12);
        --radius-lg: 14px;
        --radius-sm: 8px;
      }

      /* Container tweaks to keep things neat */
      main.container {
        max-width: 1200px;
        margin: 0 auto 60px;
        padding: 24px;
      }

      /* FILTER BAR — modern, centered, subtle glass look */
      .filter-bar {
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
        background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.7));
        border-radius: var(--radius-lg);
        padding:12px 16px;
        box-shadow: var(--shadow-sm);
        margin: 18px auto 32px;
        position: relative;
        z-index: 5;
        backdrop-filter: blur(6px) saturate(120%);
      }

      .filter-left {
        display:flex;
        gap:12px;
        align-items:center;
      }

      .filter-toggle {
        display:flex;
        align-items:center;
        gap:10px;
        padding:10px 14px;
        background: transparent;
        border: 1px solid rgba(15,23,36,0.06);
        border-radius: 999px;
        cursor:pointer;
        transition: all .18s ease;
        box-shadow: 0 2px 8px rgba(2,6,23,0.04);
      }
      .filter-toggle:focus, .filter-toggle:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); outline: none; }

      .filter-toggle i { font-size:1.05rem; color:var(--accent); }
      .filter-toggle .label { font-weight:600; color:var(--accent); font-size:0.95rem; }
      .filter-toggle .badge {
        background: linear-gradient(90deg, var(--accent-2), #4c8cff);
        color: white;
        padding: 4px 8px;
        font-size:0.8rem;
        border-radius:999px;
        font-weight:600;
        box-shadow: 0 4px 10px rgba(31,111,235,0.12);
      }

      .controls-right {
        display:flex;
        gap:12px;
        align-items:center;
      }

      .result-count {
        font-weight:600;
        color:var(--accent);
        font-size:0.95rem;
        min-width:110px;
        text-align:right;
      }

      select#sortSelect {
        padding:8px 10px;
        border-radius:10px;
        border:1px solid rgba(15,23,36,0.06);
        background: white;
        font-weight:600;
      }

      /* Filters panel — card style, animated */
      #filters-panel {
        position:absolute;
        left:50%;
        transform:translateX(-50%) translateY(-8px);
        top: calc(100% + 8px);
        width: min(1000px, calc(100% - 40px));
        background: var(--card);
        padding:22px;
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        display:none;
        transition: transform .18s ease, opacity .18s ease;
      }
      #filters-panel[aria-hidden="false"] {
        display:block;
        transform: translateX(-50%) translateY(6px);
        opacity:1;
      }

      .filters-grid {
        display:grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap:18px;
      }
      .filter-group h4 { margin:0 0 8px; font-size:0.95rem; color:var(--accent); }
      .filter-group label { display:flex; align-items:center; gap:8px; color:var(--muted); font-size:0.92rem; cursor:pointer; }
      .filter-actions { display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-top:8px; }

      .btn {
        border:0;
        padding:10px 14px;
        border-radius:10px;
        cursor:pointer;
        font-weight:600;
      }
      .btn-primary { background:var(--accent); color:#fff; box-shadow: 0 8px 20px rgba(15,23,36,0.08); }
      .btn-ghost { background:transparent; border:1px solid rgba(15,23,36,0.06); color:var(--accent); }

      /* Product grid */
      .product-grid {
        display:grid;
        grid-template-columns: repeat(4, 1fr);
        gap:20px;
        margin-top:26px;
      }

/* =========================
   RESPONSIVE MEDIA QUERIES
   (copiar/colar no fim do ficheiro CSS)
   ========================= */



/* Desktop / large laptop */
@media (min-width: 1200px) and (max-width: 1399px) {
  main.container { max-width: 1200px; padding: 28px; }
  .product-grid { grid-template-columns: repeat(4, 1fr); gap: 24px; }
  .product-media { height:210px; }
  h1 { font-size:3.6rem; }
}

/* Medium laptop -> tablet landscape */
@media (max-width: 1199px) and (min-width: 900px) {
  main.container { padding: 24px; }
  .product-grid { grid-template-columns: repeat(3, 1fr); gap: 20px; }
  .product-media { height:200px; }
  .filter-bar { padding: 10px 14px; gap:8px; }
  .filter-toggle { padding:8px 12px; }
  .result-count { min-width:90px; font-size:0.92rem; }
  select#sortSelect { padding:7px 10px; font-size:0.95rem; }
  h1 { font-size:3rem; }
  .navbar-items-li { gap:10px; }
}

/* Small laptop -> large tablet */
@media (max-width: 899px) and (min-width: 700px) {
  .product-grid { grid-template-columns: repeat(2, 1fr); gap:18px; }
  .product-media { height:180px; }
  .filter-bar { flex-wrap:wrap; align-items:center; padding:10px; }
  .controls-right { margin-left:auto; }
  .filter-left { flex:1 1 100%; }
  .result-count { text-align:right; min-width:80px; }
  .brand-pill { font-size:0.72rem; padding:5px 8px; }
  .btn-add { padding:7px 10px; font-size:0.95rem; }
  h1 { font-size:2.6rem; }
}

/* Tablet portrait and big phones */
@media (max-width: 699px) and (min-width: 521px) {
  main.container { padding: 18px; margin-bottom: 40px; }
  .product-grid { grid-template-columns: repeat(2, 1fr); gap:16px; }
  .product-media { height:160px; border-radius:10px; }
  .product-card { padding:10px; border-radius:12px; }
  .filter-bar { padding:10px; border-radius:12px; gap:10px; }
  .filter-toggle { padding:8px 10px; font-size:0.95rem; }
  .controls-right { gap:8px; }
  select#sortSelect { padding:7px 8px; font-size:0.92rem; }
  .result-count { font-size:0.9rem; min-width:70px; }
  .product-body .title { font-size:0.98rem; }
  .excerpt { font-size:0.86rem; min-height:30px; }
  h1 { font-size:2.4rem; width:90%; margin: 6px auto 12px; }
  .navbar-items-li { display:none; } /* rely on hamburger for compact screens */
  .navbar-right .navbar-items-icons input[type="search"] { display:none; } /* hide search field to save space */
  .navbar-right .icon-btn { padding:8px; } 
}

/* Small phones and narrow screens — mobile first adjustments */
@media (max-width: 520px) {
  /* Layout: single column */
  main.container { padding: 14px; margin-bottom: 30px; }
  .product-grid { grid-template-columns: 1fr; gap:14px; }
  .product-media { height:140px; }
  .product-card { padding:10px; border-radius:12px; }
  .brand-pill { left:8px; top:8px; padding:5px 8px; font-size:0.7rem; }
  .btn-wish { right:8px; top:8px; padding:8px; }
  .product-body { padding: 0 4px; }
  .title { font-size:1rem; line-height:1.15; }
  .excerpt { font-size:0.85rem; color:var(--muted); min-height:30px; }
  .price { font-size:1rem; }
  .btn-add { padding:8px 10px; font-size:0.95rem; }

  /* Filter bar becomes stacked and full width */
  .filter-bar {
    flex-direction:column;
    align-items:stretch;
    gap:10px;
    padding:12px;
  }
  .filter-left, .controls-right { width:100%; display:flex; justify-content:space-between; align-items:center; }
  .controls-right { gap:10px; }

  /* Filters panel: full-screen style modal on mobile */
  #filters-panel {
    position: fixed;
    left: 0;
    right: 0;
    top: 0;
    transform: none !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 18px;
    height: 100vh;
    overflow:auto;
    border-radius: 0;
    box-shadow: 0 30px 80px rgba(2,6,23,0.2);
  }
  #filters-panel[aria-hidden="true"] { display:none; }

  .filters-grid { grid-template-columns: 1fr; gap:14px; }
  .filter-actions { justify-content:stretch; gap:8px; flex-direction:row; }
  .btn-primary, .btn-ghost { width:48%; padding:12px 10px; }

  /* Improve tap targets */
  .filter-toggle, .btn-add, .icon-btn { min-height:44px; min-width:44px; border-radius:12px; }

  /* Navbar adjustments */
  .navbar-items-li { display:none; } /* show hamburger only */
  .hamburger-btn { display:inline-flex; align-items:center; justify-content:center; padding:10px; border-radius:10px; }
  .navbar-items-logo img { height:40px; }
  .navbar-right .navbar-items-icons input[type="search"] { display:none; }
  .navbar-right .icon-btn { padding:8px; }

  /* Footer stack */
  .footer { padding:18px; text-align:center; }
  .footer-column-2, .footer-column-3 { display:flex; justify-content:center; gap:12px; margin-top:10px; flex-wrap:wrap; }
  .footer-row h4 { font-size:0.85rem; margin-top:10px; }
}

/* Very small devices / landscape tiny devices */
@media (max-width: 420px) {
  h1 { font-size:2rem; }
  .product-media { height:120px; }
  .excerpt { font-size:0.82rem; min-height:26px; }
  .price { font-size:0.96rem; }
  .brand-pill { font-size:0.66rem; padding:4px 7px; }
  .btn-add { font-size:0.92rem; padding:8px; }
  .filter-bar { padding:10px; gap:8px; }
  #filters-panel { padding:14px; }
  .btn-primary, .btn-ghost { padding:10px; font-size:0.92rem; }
}

/* Touch-target and accessibility polish for small screens */
@media (hover: none) {
  .product-card:hover { transform:none; box-shadow: 0 8px 20px rgba(2,6,23,0.06); }
  .filter-toggle:focus, .btn-add:focus, .icon-btn:focus { box-shadow: 0 8px 18px rgba(31,111,235,0.12); outline: none; }
}

/* Utility: ensure images don't overflow in very small widths */
@media (max-width: 520px) {
  .product-media img { max-width: 100%; height: auto; object-fit: contain; }
}

/* End of responsive rules */

      /* Product card modern */
      .product-card {
        background: linear-gradient(180deg, #fff, #ffffff);
        border-radius: 12px;
        padding:12px;
        box-shadow: 0 6px 20px rgba(2,6,23,0.04);
        display:flex;
        flex-direction:column;
        gap:12px;
        transition: transform .14s ease, box-shadow .14s ease;
        position:relative;
        overflow:hidden;
      }
      .product-card:focus-within, .product-card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(2,6,23,0.08); outline: none; }

      .product-media {
        width:100%;
        height:190px;
        border-radius:10px;
        background: linear-gradient(180deg, #f7f7f9, #ffffff);
        display:flex;
        align-items:center;
        justify-content:center;
        position:relative;
        overflow:hidden;
      }
      .product-media img { width:auto; max-height:100%; display:block; transition: transform .3s ease; }
      .product-card:hover .product-media img { transform: scale(1.06); }

      .brand-pill {
        position:absolute;
        left:10px;
        top:10px;
        background:rgba(0,0,0,0.06);
        padding:6px 10px;
        border-radius:999px;
        font-weight:700;
        font-size:0.78rem;
        color:var(--accent);
        backdrop-filter: blur(4px);
      }

      .btn-wish {
        position:absolute;
        right:10px;
        top:10px;
        background:rgba(255,255,255,0.9);
        border:0;
        padding:8px;
        border-radius:999px;
        box-shadow: 0 6px 16px rgba(2,6,23,0.04);
        cursor:pointer;
      }

      .product-body { display:flex; flex-direction:column; gap:8px; padding: 0 6px; }
      .title { font-size:1rem; margin:0; font-weight:700; color:var(--accent); }
      .excerpt { font-size:0.9rem; color:var(--muted); margin:0; min-height:36px; }
      .product-footer { display:flex; justify-content:space-between; align-items:center; gap:12px; }

      .price { font-weight:800; font-size:1.05rem; color:var(--accent); }
      .actions { display:flex; gap:8px; align-items:center; }

      .btn-add {
        background: linear-gradient(90deg, var(--accent-2), #4c8cff);
        color:white;
        border-radius:10px;
        padding:8px 10px;
        border:0;
        cursor:pointer;
        display:flex;
        align-items:center;
        gap:8px;
        font-weight:700;
      }

      /* tiny accessibility helper */
      .visually-hidden { position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }

    </style>
  </head>

  <body>
    <!-- NAVBAR: (mantive a estrutura original) -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
      <div class="navbar-items container" id="main-navbar">
        <div class="navbar-left" style="align-items:center; gap:12px;">
          <button class="hamburger-btn" id="hamburgerBtn" aria-label="Abrir menu" aria-controls="mobileMenu" aria-expanded="false">
            <i class="fa-solid fa-bars" aria-hidden="true"></i>
          </button>

          <div class="navbar-items-logo" style="margin-left:6px;">
            <a href="../../index.html" aria-label="OASIS COREANO - Página inicial">
              <img src="../images/TESTELOGO.png" alt="Logo OASIS COREANO" style="height:44px; width:auto; display:block;" />
            </a>
          </div>
        </div>

        <div class="navbar-center" aria-hidden="true" style="pointer-events:none;"></div>

        <ul class="navbar-items-li" role="menubar">
          <li class="navbar-item" role="none"><a role="menuitem" href="Catalog.html">CATÁLOGO</a></li>
          <li class="navbar-item" id="active" role="none"><a role="menuitem" href="MustSeller.html">MAIS VENDIDOS</a></li>
          <li class="navbar-item" role="none"><a role="menuitem" href="#">SOBRE NÓS</a></li>
          <li class="navbar-item" role="none"><a role="menuitem" href="#">GUIA</a></li>
        </ul>

        <div class="navbar-right" style="align-items:center;">
          <div class="navbar-items-icons">
            <input type="search" name="Navbar-search" placeholder="Procurar ..." aria-label="Pesquisar" />
            <button class="icon-btn" aria-label="Favoritos"><i class="fa-regular fa-heart"></i></button>
            <button class="icon-btn" aria-label="Carrinho"><i class="fa-solid fa-bag-shopping"></i></button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main catalogue area -->
    <main class="container" id="mainCatalog">

      <h1 style="margin: 8px 0 12px; font-size:3.6rem;text-align: center; margin-top: 4px; font-family: 'Poppins', sans-serif;">MAIS VENDIDOS</h1>
      <p style="margin:0 0 18px;color:var(--muted);text-align: center; width: 72%; margin: 0 auto 28px;">Explora os nossos Mais Vendidos e descobre os produtos que têm transformado rotinas de cuidado pelo mundo fora. Selecionámos fórmulas eficazes, leves e adequadas a vários tipos de pele. Escolhe os que melhor acompanham o teu dia a dia.</p>

      <div class="filter-bar" role="region" aria-label="Controles de filtro e organização">
        <div class="filter-left">
          <button id="toggleFiltersBtn" class="filter-toggle" aria-haspopup="dialog" aria-expanded="false" aria-controls="filters-panel" title="Abrir filtros">
            <i class="fa-solid fa-filter"></i>
            <span class="label">Filtros</span>
            <span class="badge" id="activeFiltersCount">0</span>
          </button>
        </div>

        <div class="controls-right" aria-live="polite">
          <div class="result-count" id="resultCount">0 produtos</div>
          <label for="sortSelect" class="visually-hidden">Organizar por</label>
          <select id="sortSelect" aria-label="Organizar por">
            <option value="relevance">Relevância</option>
            <option value="price-asc">Preço: baixo → alto</option>
            <option value="price-desc">Preço: alto → baixo</option>
            <option value="name-asc">Nome: A → Z</option>
            <option value="name-desc">Nome: Z → A</option>
          </select>
        </div>

        <!-- Painel de filtros (oculto por padrão) -->
        <div id="filters-panel" role="dialog" aria-modal="false" aria-hidden="true" aria-labelledby="filtersTitle">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <h3 id="filtersTitle" style="margin:0; font-weight:800; color:var(--accent);">Filtros</h3>
            <div style="display:flex; gap:8px; align-items:center;">
              <button id="clearFiltersBtn" class="btn btn-ghost" aria-label="Limpar filtros">Limpar</button>
              <button id="closeFiltersBtn" class="btn btn-primary" aria-label="Fechar filtros">Aplicar e fechar</button>
            </div>
          </div>

          <form id="filtersForm" class="filters-grid" aria-describedby="filtersDescription">
            <div class="filter-group" id="filter-brand">
              <h4>Marca</h4>
              <div id="brandCheckboxes" role="group" aria-label="Filtrar por marca">
                <!-- preenchido dinamicamente -->
              </div>
            </div>

            <div class="filter-group" id="filter-type">
              <h4>Tipo</h4>
              <div id="typeCheckboxes" role="group" aria-label="Filtrar por tipo de produto">
                <!-- preenchido dinamicamente -->
              </div>
            </div>

            <div class="filter-group" id="filter-price">
              <h4>Preço</h4>
              <div role="group" aria-label="Filtrar por preço">
                <label><input type="checkbox" name="price" value="0-12"> Até 12 €</label>
                <label><input type="checkbox" name="price" value="12-18"> 12 € – 18 €</label>
                <label><input type="checkbox" name="price" value="18-9999"> Mais de 18 €</label>
              </div>
            </div>

            <div class="filter-group" id="filter-rating">
              <h4>Avaliação (simulada)</h4>
              <div role="group" aria-label="Filtrar por avaliação">
                <label><input type="checkbox" name="rating" value="4"> 4★ ou mais</label>
                <label><input type="checkbox" name="rating" value="3"> 3★ ou mais</label>
              </div>
            </div>

            <div class="filter-group">
              <h4>Pesquisar no catálogo</h4>
              <input type="search" id="quickSearch" placeholder="Ex: centella, protetor, ginseng..." aria-label="Pesquisar no catálogo">
            </div>

            <div class="filter-group" style="align-self:end;">
              <div class="filter-actions">
                <button type="button" id="applyFiltersBtn" class="btn btn-primary">Aplicar</button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Aqui os cards serão injectados pelo JS -->
      <section style="margin-bottom: 100px;" id="shopItems-list" class="product-grid" role="list" aria-label="Lista de produtos"></section>
    </main>

    <footer class="footer container">
      <div class="footer-column-1">
        <img src="../images/TESTELOGO.png" alt="Footer Logo">
      </div>
      <div class="footer-column-2">
        <li class="footer-item">CATÁLOGO</li>
        <li class="footer-item">MAIS VENDIDOS</li>
        <li class="footer-item">SOBRE NÓS</li>
      </div>
      <div class="footer-column-3">
        <li class="footer-item-social">INSTAGRAM</li>
        <li class="footer-item-social">FACEBOOK</li>
        <li class="footer-item-social">X / TWITTER</li>
      </div>
      <div class="footer-row">
        <h4>OASIS COREANO 2025© All rights deserved!</h4>
        <h4><a href="#">Politica de Privacidade</a></h4>
        <h4><a href="#">Termos de Serviços</a></h4>
      </div>
    </footer>

    <!-- Script: dados + renderização + filtros/ordenar (funcional e corrigido) -->
    <script>
      const shopItems = [
        {img:"../images/PRODUCTS/PRODUCT1.png", brand:"SKIN1004", name:"Madagascar Centella Ampoule", price:"10,95 €", description:"Soro de centella — acabamento premium."},
        {img:"../images/PRODUCTS/PRODUCT2.png", brand:"SKIN1004", name:"Madagascar Centella Hyalu-Cica Water-Fit Sun Serum SPF50+ PA++++", price:"14,75 €", description:"Sérum solar leve com proteção alta."},
        {img:"../images/PRODUCTS/PRODUCT3.png", brand:"SKIN1004", name:"Madagascar Centella Light Cleansing Oil", price:"9,74 €", description:"Óleo de limpeza leve."},
        {img:"../images/PRODUCTS/PRODUCT4.png", brand:"SKIN1004", name:"Madagascar Centella Travel Kit", price:"28,41 €", description:"Kit de viagem prático."},
        {img:"../images/PRODUCTS/PRODUCT5.png", brand:"SKIN1004", name:"Madagascar Centella Tone Brightening Capsule Ampoule", price:"15,95 €", description:"Ampola iluminadora."},
        {img:"../images/PRODUCTS/PRODUCT6.png", brand:"SKIN1004", name:"Madagascar Centella Ampoule Foam", price:"16,11 €", description:"Espuma de limpeza com centella."},
        {img:"../images/PRODUCTS/PRODUCT7.png", brand:"SKIN1004", name:"Madagascar Centella Poremizing Quick Clay Stick Mask", price:"19,50 €", description:"Máscara de argila em stick."},
        {img:"../images/PRODUCTS/PRODUCT8.png", brand:"SKIN1004", name:"Madagascar Centella Probio-Cica Intensive Ampoule", price:"27,95 €", description:"Ampola intensiva probiótica."},
        {img:"../images/PRODUCTS/PRODUCT9.png", brand:"Beauty of Joseon", name:"Relief Sun : Rice + Probiotics SPF50+ PA++++", price:"17,90 €", description:"Protetor solar com arroz e probióticos."},
        {img:"../images/PRODUCTS/PRODUCT10.png", brand:"Beauty of Joseon", name:"Revive Eye Serum : Ginseng + Retinal", price:"17,95 €", description:"Sérum de olhos com ginseng."},
        {img:"../images/PRODUCTS/PRODUCT11.png", brand:"Beauty of Joseon", name:"Dynasty Cream", price:"23,95 €", description:"Creme nutritivo premium."},
        {img:"../images/PRODUCTS/PRODUCT12.png", brand:"Beauty of Joseon", name:"Glow Serum Propolis+Niacinamide", price:"14,85 €", description:"Sérum com própolis e niacinamida."},
        {img:"../images/PRODUCTS/PRODUCT13.png", brand:"Beauty of Joseon", name:"Relief Sun Aqua-fresh : Rice + B5 SPF50+ PA++++", price:"16,80 €", description:"Protetor solar leve Aqua-fresh."},
        {img:"../images/PRODUCTS/PRODUCT14.png", brand:"Beauty of Joseon", name:"Green Plum Refreshing Cleanser", price:"12,95 €", description:"Gel de limpeza com ameixa verde."},
        {img:"../images/PRODUCTS/PRODUCT15.png", brand:"Beauty of Joseon", name:"Glow Replenishing Rice Milk", price:"18,95 €", description:"Leite hidratante de arroz."},
        {img:"../images/PRODUCTS/PRODUCT16.png", brand:"Beauty of Joseon", name:"Ginseng Essence Water", price:"17,95 €", description:"Essência hidratante de ginseng."}
      ];

      // DOM references
      const containerShopItems = document.getElementById('shopItems-list');
      const resultCountEl = document.getElementById('resultCount');
      const activeFiltersCountEl = document.getElementById('activeFiltersCount');
      const filtersPanel = document.getElementById('filters-panel');
      const toggleFiltersBtn = document.getElementById('toggleFiltersBtn');
      const closeFiltersBtn = document.getElementById('closeFiltersBtn');
      const applyFiltersBtn = document.getElementById('applyFiltersBtn');
      const clearFiltersBtn = document.getElementById('clearFiltersBtn');
      const sortSelect = document.getElementById('sortSelect');
      const filtersForm = document.getElementById('filtersForm');
      const quickSearch = document.getElementById('quickSearch');

      // displayedItems tracks the currently rendered items so actions map correctly
      let displayedItems = [];

      // Utility: escape HTML
      function escapeHtml(str = '') {
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      // Parse price "10,95 €" => 10.95
      function parsePrice(priceStr) {
        if (!priceStr) return 0;
        const cleaned = priceStr.replace('€','').replace(/\s/g,'').replace(',', '.');
        const n = parseFloat(cleaned);
        return Number.isFinite(n) ? n : 0;
      }

      // Detect types from name/description (simple keyword mapping)
      function detectType(item) {
        const text = (item.name + ' ' + (item.description || '')).toLowerCase();
        const map = [
          {words:['sun','spf','protetor'], label:'Protetor solar'},
          {words:['serum','sérum','ampoule','ampola'], label:'Sérum / Ampola'},
          {words:['clean','limpeza','cleans','cleansing','foam','gel','oil','cleanser'], label:'Limpeza'},
          {words:['cream','creme','milk','leite'], label:'Creme / Hidratante'},
          {words:['mask','máscara','clay','stick'], label:'Máscara'},
          {words:['kit','travel'], label:'Kit / Travel'},
          {words:['eye','olho','eye serum'], label:'Olhos'},
          {words:['essence','essência'], label:'Essência'}
        ];
        for (const m of map) {
          for (const w of m.words) {
            if (text.includes(w)) return m.label;
          }
        }
        return 'Outro';
      }

      // Build dynamic filter options (brands + types)
      function buildDynamicFilters() {
        const brands = Array.from(new Set(shopItems.map(i => i.brand))).sort();
        const brandContainer = document.getElementById('brandCheckboxes');
        brandContainer.innerHTML = brands.map(b =>
          `<label><input type="checkbox" name="brand" value="${escapeHtml(b)}"> ${escapeHtml(b)}</label>`
        ).join('');

        const types = Array.from(new Set(shopItems.map(i => detectType(i)))).sort();
        const typeContainer = document.getElementById('typeCheckboxes');
        typeContainer.innerHTML = types.map(t =>
          `<label><input type="checkbox" name="type" value="${escapeHtml(t)}"> ${escapeHtml(t)}</label>`
        ).join('');
      }

      // Create product card markup using displayedItems index
      function createCardMarkup(item, idx) {
        const imgSrc = item.img && item.img.trim() ? item.img : '../images/PRODUCTS/placeholder.png';
        const brand = escapeHtml(item.brand);
        const title = escapeHtml(item.name);
        const desc = escapeHtml(item.description);
        const price = escapeHtml(item.price);

        // simple star display (simulated)
        const rating = item.priceValue > 20 ? '★★★★☆' : (item.priceValue >= 15 ? '★★★☆☆' : '★★★★☆');

        return `
          <article class="product-card" role="listitem" tabindex="0" aria-label="${title}" data-index="${idx}">
            <figure class="product-media" aria-hidden="true">
              <span class="brand-pill">${brand}</span>
              <img src="${escapeHtml(imgSrc)}" alt="${title}">
              <button class="btn-wish" aria-label="Adicionar ${title} aos favoritos" data-action="wish" data-index="${idx}">
                <i class="fa-regular fa-heart" aria-hidden="true"></i>
              </button>
            </figure>

            <div class="product-body">
              <h3 class="title">${title}</h3>
              <p class="excerpt">${desc}</p>

              <div class="product-footer">
                <div>
                  <div class="price">${price}</div>
                  <div class="rating" aria-hidden="true" style="color:var(--muted); font-size:0.9rem;">${rating}</div>
                </div>

                <div class="actions">
                  <button class="btn-add" aria-label="Adicionar ao carrinho: ${title}" data-action="add" data-index="${idx}">
                    <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
                    <span>Adicionar</span>
                  </button>
                </div>
              </div>
            </div>
          </article>
        `;
      }

      // Get active filters from form
      function getActiveFilters() {
        const formData = new FormData(filtersForm);
        const brands = formData.getAll('brand');
        const types = formData.getAll('type');
        const prices = formData.getAll('price');
        const ratings = formData.getAll('rating').map(r => Number(r));
        const q = (quickSearch.value || '').trim().toLowerCase();
        return { brands, types, prices, ratings, q };
      }

      // Apply filters, sorting and render
      function applyFiltersAndSort(closeAfter = false) {
        const active = getActiveFilters();

        let items = shopItems.map(i => ({ ...i, priceValue: parsePrice(i.price), type: detectType(i) }));

        // Brand filter
        if (active.brands.length) items = items.filter(i => active.brands.includes(i.brand));
        // Type filter
        if (active.types.length) items = items.filter(i => active.types.includes(i.type));
        // Price filter OR across selections
        if (active.prices.length) {
          items = items.filter(i => active.prices.some(range => {
            const [min, max] = range.split('-').map(Number);
            return i.priceValue >= min && i.priceValue <= max;
          }));
        }
        // Rating (simulated)
        if (active.ratings.length) {
          items = items.filter(i => {
            const r = i.priceValue > 20 ? 4.2 : (i.priceValue >= 15 ? 3.8 : 4.0);
            return active.ratings.some(minR => r >= minR);
          });
        }
        // Quick search
        if (active.q) {
          items = items.filter(i => (i.name + ' ' + (i.description || '') + ' ' + i.brand).toLowerCase().includes(active.q));
        }

        // Sort
        const sort = sortSelect.value;
        if (sort === 'price-asc') items.sort((a,b) => a.priceValue - b.priceValue);
        else if (sort === 'price-desc') items.sort((a,b) => b.priceValue - a.priceValue);
        else if (sort === 'name-asc') items.sort((a,b) => a.name.localeCompare(b.name));
        else if (sort === 'name-desc') items.sort((a,b) => b.name.localeCompare(a.name));
        // relevance -> original order, keep as is

        // Update global displayedItems and render
        displayedItems = items;
        renderDisplayedItems();

        // Update counters/badges
        resultCountEl.textContent = `${items.length} produto${items.length !== 1 ? 's' : ''}`;
        activeFiltersCountEl.textContent = countActiveFilters();

        if (closeAfter) closeFilters();
      }

      function renderDisplayedItems() {
        const html = displayedItems.map((item, idx) => createCardMarkup(item, idx)).join('');
        containerShopItems.innerHTML = html;
      }

      function countActiveFilters() {
        const checkboxes = filtersForm.querySelectorAll('input[type="checkbox"]');
        let count = 0;
        checkboxes.forEach(cb => { if (cb.checked) count++; });
        if (quickSearch.value.trim()) count++;
        return count;
      }

      // Delegated grid click handling (actions refer to displayedItems)
      function handleGridClick(e) {
        const btn = e.target.closest('[data-action]');
        if (!btn) return;
        const action = btn.dataset.action;
        const index = Number(btn.dataset.index);
        const item = displayedItems[index];
        if (!item) return;

        if (action === 'add') {
          console.log('Adicionar ao carrinho:', item.name);
          btn.setAttribute('aria-pressed', 'true');
          btn.disabled = true;
          btn.innerHTML = '<i class="fa-solid fa-check" aria-hidden="true"></i>';
        }

        if (action === 'wish') {
          console.log('Favoritos:', item.name);
          const icon = btn.querySelector('i');
          btn.setAttribute('aria-pressed', btn.getAttribute('aria-pressed') === 'true' ? 'false' : 'true');
          if (icon) icon.classList.toggle('fa-solid'), icon.classList.toggle('fa-regular');
        }
      }

      // Open/close filters panel with focus management
      function openFilters() {
        filtersPanel.setAttribute('aria-hidden','false');
        filtersPanel.setAttribute('aria-modal','true');
        toggleFiltersBtn.setAttribute('aria-expanded','true');
        // focus first interactive element
        setTimeout(() => {
          filtersPanel.querySelector('input, button, select')?.focus();
        }, 120);
        // trap focus loosely: add keydown listener
      }

      function closeFilters() {
        filtersPanel.setAttribute('aria-hidden','true');
        filtersPanel.setAttribute('aria-modal','false');
        toggleFiltersBtn.setAttribute('aria-expanded','false');
        toggleFiltersBtn.focus();
      }

      // Clear all filters
      function clearAllFilters() {
        filtersForm.reset();
        quickSearch.value = '';
        sortSelect.value = 'relevance';
        applyFiltersAndSort();
      }

      // Initialization
      document.addEventListener('DOMContentLoaded', () => {
        buildDynamicFilters();
        applyFiltersAndSort();

        // Events
        toggleFiltersBtn.addEventListener('click', () => {
          const hidden = filtersPanel.getAttribute('aria-hidden') === 'true';
          if (hidden) openFilters(); else closeFilters();
        });

        // Apply/close buttons
        applyFiltersBtn.addEventListener('click', () => applyFiltersAndSort(true));
        closeFiltersBtn.addEventListener('click', () => applyFiltersAndSort(true));
        clearFiltersBtn.addEventListener('click', () => clearAllFilters());

        // Live updates for active filters badge
        filtersForm.addEventListener('change', () => { activeFiltersCountEl.textContent = countActiveFilters(); });
        quickSearch.addEventListener('input', () => { activeFiltersCountEl.textContent = countActiveFilters(); });

        // sort change triggers re-render
        sortSelect.addEventListener('change', () => applyFiltersAndSort());

        // quickSearch Enter to apply
        quickSearch.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            applyFiltersAndSort(true);
          }
        });

        // delegated click on product grid
        containerShopItems.addEventListener('click', handleGridClick);

        // keyboard: enter on card opens simulated product view
        containerShopItems.addEventListener('keydown', (e) => {
          const card = e.target.closest('.product-card');
          if (!card) return;
          if (e.key === 'Enter') {
            const index = Number(card.dataset.index);
            const item = displayedItems[index];
            console.log('Abrir produto (simulado):', item?.name);
          }
        });

        // close panel on ESC
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && filtersPanel.getAttribute('aria-hidden') === 'false') {
            closeFilters();
          }
        });
      });
    </script>
  </body>
</html>
